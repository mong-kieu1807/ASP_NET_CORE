@using SportsStore.Domain.Models
@model IEnumerable<Product>
@{
    ViewData["Title"] = "Danh sách sản phẩm";
    int itemsPerPage = ViewBag.ItemsPerPage > 0 ? (int)ViewBag.ItemsPerPage : 1;
    int totalPages = (int)Math.Ceiling((decimal)ViewBag.TotalItems / itemsPerPage);
    string currentCategory = ViewBag.CurrentCategory as string ?? "";
    int currentPage = ViewBag.CurrentPage ?? 1;
    var categories = ViewBag.Categories as IEnumerable<string>;
}
<h1 class="text-center my-4">@ViewData["Title"]</h1>
@if (!string.IsNullOrEmpty(ViewBag.CurrentCategory) && ViewBag.CurrentCategory != "Tất cả sản phẩm")
{
    <h2 class="text-primary">Danh mục: @ViewBag.CurrentCategory</h2>
}
@if (TempData["message"] != null)
{ 
    <div class="alert alert-success">@TempData["message"]</div>
}
@if (Model != null && Model.Any())
{
 <table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Tên</th>
            <th>Mô tả</th>
            <th>Giá</th>
            <th>Danh mục</th>
            <th class="text-center">Hành động</th> 
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var p in Model)
        {
            <tr>
                <td>@p.ProductID</td>
                <td>@p.Name</td>
                <td>@p.Description</td>
                <td>$ @p.Price.ToString("#,##0.0")</td> @* Định dạng tiền tệ *@
                <td>@p.Category</td>
                <td class="text-center" style="width: 150px;">
                    <a asp-action="Edit" asp-route-productId="@p.ProductID" class="btn btn-sm btn-warning">
                        Sửa
                    </a>
                    <form asp-action="Delete" asp-route-productId="@p.ProductID" method="post" style="display:inline-block;">
                        <button type="submit" class="btn btn-sm btn-danger"
                            onclick="return confirm('Bạn có chắc chắn muốn xóa @p.Name không?');">
                            Xóa
                        </button>
                    </form>
                </td>
                <td>
                <a asp-controller="Product" asp-action="Details" asp-route-id="@p.ProductID" class="btn btn-info btn-sm">Chi tiết</a>
                </td>
                <td class="text-center">
                <form asp-action="AddToCart" asp-controller="Cart" method="post" style="display:inline-block;">
                    <input type="hidden" name="productId" value="@p.ProductID" />
                    <input type="hidden" name="returnUrl" value="@(Context.Request.Path + Context.Request.QueryString)" /> 
                    <button type="submit" class="btn btn-sm btn-success"> Thêm vào giỏ</button>
                </form>
                </td>
            </tr>
        }
    </tbody>
 </table>
 <div class="text-end mb-3" style="margin-bottom: 15px;">
 <a asp-action="Create" class="btn btn-primary">Thêm sản phẩm mới</a>
</div>
 @* Phần phân trang *@
 <nav>
    <ul class="pagination justify-content-center">
    @for (int i = 1; i <= totalPages; i++) // Tạo các nút trang từ 1 đến tổng số trang
    {
    @* Thêm class "active" nếu đây là trang hiện tại *@
    <li class="page-item @(i == ViewBag.CurrentPage ?"active" : "")">
        <a class="page-link" asp-controller="Product" asp-action="List"asp-route-productPage="@i">@i</a>
    </li>
    //asp-route-category="@ViewBag.CurrentCategory" ->@*Truyền danh mục hiện tại để duy trì bộ lọc *@
    //asp-route-productPage="@i">@i</a> ->@* Truyền số trang *@
    }
    </ul>
 </nav>

}
else
{
    <p class="alert alert-info">Không có sản phẩm nào để hiển thị trong danh mục này.</p>
}
<p>
 <a asp-controller="Home" asp-action="Index" class="btn btnsecondary">Về trang chủ</a>
</p>
<div class="mt-4">
    <h4>Lọc theo danh mục:</h4>
    @* Liên kết "Tất cả" để bỏ lọc danh mục *@
    <a asp-controller="Product" asp-action="List" asp-route-category=""
    class="btn btn-outline-secondary mb-1">Tất cả</a>
    @* Các liên kết lọc theo danh mục cụ thể (cần khớp với dữ liệu trong
    FakeProductRepository) *@
    <a asp-controller="Product" asp-action="List" asp-route-category="Bóng đá" class="btn btn-outline-secondary mb-1">Bóng đá</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Tennis" class="btn btn-outline-secondary mb-1">Tennis</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Quần áo" class="btn btn-outline-secondary mb-1">Quần áo</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Giày dép" class="btn btn-outline-secondary mb-1">Giày dép</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Bóng chuyền" class="btn btn-outline-secondary mb-1">Bóng chuyền</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Cầu lông" class="btn btn-outline-secondary mb-1">Cầu lông</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Bóng rổ" class="btn btn-outline-secondary mb-1">Bóng rổ</a>
    <a asp-controller="Product" asp-action="List" asp-route-category="Phụ kiện" class="btn btn-outline-secondary mb-1">Phụ kiện</a>
</div>